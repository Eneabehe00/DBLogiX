{% extends 'base.html' %}

{% block title %}Sezione {{ section.NombreSeccion }} - DBLogiX{% endblock %}

{% block header_title %}Dettaglio Sezione{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/sections.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/shared-components.css') }}">
<style>
    /* Mobile optimizations for section detail */
    :root {
        --primary-dark: #2c3e50;
        --secondary-dark: #34495e;
        --accent-blue: #3498db;
        --light-gray: #f8f9fa;
        --success-green: #27ae60;
        --border-light: #e9ecef;
    }
    
    /* Container width optimization for mobile */
    @media (max-width: 767.98px) {
        .container-fluid {
            padding-left: 5px !important;
            padding-right: 5px !important;
        }
        
                 /* Page header improvements */
         .page-header {
             padding: 20px 15px;
         }
        
        .page-title {
            font-size: 1.5rem;
            line-height: 1.2;
        }
        
        .page-subtitle {
            font-size: 0.9rem;
        }
        
        .action-btn {
            padding: 8px 12px;
            font-size: 0.85rem;
        }
        
        /* Card improvements */
        .card {
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(44, 62, 80, 0.08);
            border: 1px solid rgba(52, 152, 219, 0.1);
            margin-bottom: 15px;
        }
        
        .card-body {
            padding: 15px;
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--primary-dark), var(--secondary-dark));
            color: white;
            border-radius: 15px 15px 0 0;
            padding: 15px;
        }
        
        .card-title {
            font-size: 1rem;
            margin: 0;
        }
        
        /* Table mobile optimizations */
        .table-responsive {
            border-radius: 0 0 15px 15px;
            overflow: hidden;
        }
        
        .table {
            font-size: 0.85rem;
            margin: 0;
        }
        
        .table th {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--primary-dark);
            background: rgba(52, 152, 219, 0.1);
            border: none;
            padding: 12px 8px;
        }
        
        .table td {
            border: none;
            padding: 12px 8px;
            vertical-align: middle;
        }
        
        .table-striped > tbody > tr:nth-of-type(odd) > td {
            background-color: rgba(52, 152, 219, 0.03);
        }
        
        .table-hover tbody tr:hover td {
            background-color: rgba(52, 152, 219, 0.08);
        }
        
        /* Button improvements */
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
            border-radius: 8px;
        }
        
        .btn-info {
            background: linear-gradient(135deg, var(--accent-blue), #5dade2);
            border: none;
            color: white;
        }
        
        .btn-info:hover {
            background: linear-gradient(135deg, #2980b9, var(--accent-blue));
            transform: translateY(-1px);
        }
        
        /* Alert improvements */
        .alert {
            border-radius: 12px;
            border: none;
            padding: 15px;
            margin: 15px;
        }
        
        .alert-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            color: var(--primary-dark);
            border: 1px solid rgba(52, 152, 219, 0.2);
        }
    }
    
    /* Extra small devices */
    @media (max-width: 575.98px) {
        .container-fluid {
            padding-left: 2px !important;
            padding-right: 2px !important;
        }
        
        .page-title {
            font-size: 1.3rem;
        }
        
        .card-body {
            padding: 10px;
        }
        
        .card-header {
            padding: 12px;
        }
        
        .card-title {
            font-size: 0.9rem;
        }
        
        .table {
            font-size: 0.8rem;
        }
        
        .table th,
        .table td {
            padding: 8px 6px;
        }
        
        .alert {
            margin: 10px;
            padding: 12px;
        }
    }
    
    /* Mobile table stacking for very small screens */
    @media (max-width: 480px) {
        .table-responsive {
            border: none;
        }
        
        .table, 
        .table thead, 
        .table tbody, 
        .table th, 
        .table td, 
        .table tr {
            display: block;
        }
        
        .table thead tr {
            position: absolute;
            top: -9999px;
            left: -9999px;
        }
        
        .table tbody tr {
            background: white;
            border: 1px solid rgba(52, 152, 219, 0.1);
            border-radius: 8px;
            margin-bottom: 10px;
            padding: 10px;
        }
        
        .table tbody tr:hover {
            background: rgba(52, 152, 219, 0.05);
        }
        
        .table td {
            border: none !important;
            position: relative;
            padding: 8px 8px 8px 35% !important;
            text-align: left;
            min-height: 40px;
            display: flex;
            align-items: center;
        }
        
        .table td:before {
            content: attr(data-label);
            position: absolute;
            left: 10px;
            width: 30%;
            padding-right: 10px;
            white-space: nowrap;
            text-align: left;
            font-weight: 600;
            color: var(--primary-dark);
            font-size: 0.75rem;
        }
        
        .table td:last-child {
            border-bottom: none;
            justify-content: flex-end;
            padding-left: 10px !important;
        }
        
        .table td:last-child:before {
            display: none;
        }
    }
    
    /* Animation improvements */
    .card {
        animation: fadeInUp 0.6s ease-out;
    }
    
    .table tbody tr {
        animation: slideInLeft 0.5s ease-out;
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes slideInLeft {
        from {
            opacity: 0;
            transform: translateX(-20px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Section Header -->
<div class="page-header shadow-sm mb-4">
    <div class="container-fluid">
        <div class="page-id">#{{ section.IdSeccion }}</div>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="{{ url_for('index') }}" class="text-white">Home</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('sections.index') }}" class="text-white">Sezioni</a></li>
                <li class="breadcrumb-item active text-white-50" aria-current="page">{{ section.NombreSeccion }}</li>
            </ol>
        </nav>
        <div class="row align-items-center mt-3">
            <div class="col-md-8">
                <h1 class="page-title mb-0">{{ section.NombreSeccion }}</h1>
                <p class="page-subtitle mt-2 mb-0">
                    <span class="text-white-50">ID: {{ section.IdSeccion }}</span>
                </p>
            </div>
            <div class="col-md-4 text-md-end mt-3 mt-md-0">
                {% if current_user.is_admin %}
                <div class="d-grid d-md-block gap-2">
                    <a href="{{ url_for('sections.edit', id=section.IdSeccion) }}" class="btn btn-light action-btn mb-2 mb-md-0">
                        <i class="fas fa-edit me-1"></i>Modifica
                    </a>
                    <button class="btn btn-outline-light action-btn" 
                            data-delete
                            data-id="{{ section.IdSeccion }}"
                            data-name="{{ section.NombreSeccion }}"
                            data-type="sezione"
                            data-url="{{ url_for('sections.delete', id=section.IdSeccion) }}">
                        <i class="fas fa-trash me-1"></i>Elimina
                    </button>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="container-fluid">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
    {% endif %}
    {% endwith %}
    
    <!-- Articles in this section -->
    <div class="card shadow-sm mb-4">
        <div class="card-header d-flex justify-content-between align-items-center bg-transparent">
            <h5 class="card-title mb-0"><i class="fas fa-boxes me-2 text-primary"></i>Articoli in questa Sezione</h5>
        </div>
        <div class="card-body p-0">
            {% if articles %}
            <div class="table-responsive">
                <table class="table table-striped table-hover mb-0">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Descrizione</th>
                            <th>Prezzo</th>
                            <th>Codice EAN</th>
                            <th class="text-end">Azioni</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for article in articles %}
                        <tr class="article-row" data-href="{{ url_for('articles.view', id=article.IdArticulo) }}">
                            <td data-label="ID">
                                <span class="fw-bold text-primary">#{{ article.IdArticulo }}</span>
                            </td>
                            <td data-label="Descrizione">
                                <div class="fw-semibold">{{ article.Descripcion }}</div>
                            </td>
                            <td data-label="Prezzo">
                                <span class="fw-bold {% if article.PrecioConIVA %}text-success{% else %}text-muted{% endif %}">
                                    {{ article.PrecioConIVA|price if article.PrecioConIVA else 'N/A' }}
                                </span>
                            </td>
                            <td data-label="Codice EAN">
                                {% if article.EANScanner %}
                                <span class="badge bg-primary">{{ article.EANScanner }}</span>
                                {% else %}
                                <span class="text-muted">N/A</span>
                                {% endif %}
                            </td>
                            <td class="text-end">
                                <a href="{{ url_for('articles.view', id=article.IdArticulo) }}" 
                                   class="btn btn-sm btn-info" 
                                   title="Visualizza articolo"
                                   data-bs-toggle="tooltip">
                                    <i class="fas fa-eye me-1"></i>
                                    <span class="d-none d-sm-inline">Visualizza</span>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="alert alert-info m-3">
                <i class="fas fa-info-circle me-2"></i> Nessun articolo trovato in questa sezione.
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize tooltips
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));
    
    // Enhanced table row interactions
    const articleRows = document.querySelectorAll('.article-row');
    articleRows.forEach((row, index) => {
        // Add animation delay
        row.style.animationDelay = `${index * 0.1}s`;
        
        // Make rows clickable
        row.addEventListener('click', function(e) {
            // Don't navigate if clicking on buttons or links
            if (!e.target.closest('button') && !e.target.closest('a')) {
                const url = this.dataset.href;
                if (url) {
                    window.location.href = url;
                }
            }
        });
        
        // Add hover effect
        row.addEventListener('mouseenter', function() {
            this.style.backgroundColor = 'rgba(52, 152, 219, 0.1)';
            this.style.transform = 'translateX(2px)';
        });
        
        row.addEventListener('mouseleave', function() {
            this.style.backgroundColor = '';
            this.style.transform = '';
        });
    });
    
    // Card animation
    const cards = document.querySelectorAll('.card');
    cards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.2}s`;
    });
    
    // Mobile responsive table detection
    function checkTableResponsive() {
        const table = document.querySelector('.table');
        if (table && window.innerWidth <= 480) {
            table.classList.add('mobile-stacked');
        } else if (table) {
            table.classList.remove('mobile-stacked');
        }
    }
    
    // Check on load and resize
    checkTableResponsive();
    window.addEventListener('resize', checkTableResponsive);
    
    console.log('Section detail page loaded with enhanced mobile features');
    console.log('Article rows initialized:', articleRows.length);
});
</script>
{% endblock %} 